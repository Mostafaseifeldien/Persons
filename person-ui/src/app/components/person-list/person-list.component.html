<div class="app-shell">
  <mat-toolbar color="primary" class="app-toolbar" elevation="2">
    <span class="app-title">
      <mat-icon class="brand-icon" aria-hidden="true">group</mat-icon>
      <span>Person Directory</span>
    </span>

    <span class="app-toolbar-spacer"></span>

    <span class="app-env-pill">API: http://localhost:5296</span>
  </mat-toolbar>

  <main class="app-main">
    <section class="hero">
      <div class="hero-text">
        <h1>Beautiful people overview</h1>
        <p>
          Browse the people provided by your <strong>PersonApi</strong> with a clean, modern
          interface. Use the quick search to instantly filter by name, email, or id.
        </p>
      </div>

      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search people</mat-label>
        <input
          matInput
          type="search"
          placeholder="Type a name, email, or idâ€¦"
          (input)="onFilterChange($any($event.target).value)"
        />

        <button
          *ngIf="hasFilter()"
          mat-icon-button
          matSuffix
          type="button"
          aria-label="Clear search"
          (click)="onFilterChange('')"
        >
          <mat-icon>close</mat-icon>
        </button>

        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
    </section>

    <mat-card class="persons-card" appearance="outlined">
      <mat-card-header>
        <mat-card-title>People</mat-card-title>
        <mat-card-subtitle>Data served from your ASP.NET Core API</mat-card-subtitle>
      </mat-card-header>

      <mat-progress-bar
        *ngIf="loading()"
        mode="indeterminate"
        color="accent"
        class="loading-bar"
      ></mat-progress-bar>

      <mat-card-content>
        <p *ngIf="error()" class="error-banner">
          <mat-icon aria-hidden="true">error_outline</mat-icon>
          {{ error() }}
        </p>

        <div class="table-wrapper" *ngIf="!loading() && !error()">
          <ng-container *ngIf="persons$ | async as persons">
            <table mat-table [dataSource]="filtered(persons)" class="persons-table">
              <!-- Avatar -->
              <ng-container matColumnDef="avatar">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let person">
                  <div class="avatar" [attr.aria-label]="'Avatar for ' + person.firstName">
                    {{ initials(person) }}
                  </div>
                </td>
              </ng-container>

              <!-- Name -->
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Name</th>
                <td mat-cell *matCellDef="let person">
                  <div class="person-name">
                    <span class="full-name">{{ person.firstName }} {{ person.lastName }}</span>
                    <span class="person-id">ID #{{ person.id }}</span>
                  </div>
                </td>
              </ng-container>

              <!-- Email -->
              <ng-container matColumnDef="email">
                <th mat-header-cell *matHeaderCellDef>Email</th>
                <td mat-cell *matCellDef="let person">
                  <a class="email-link" [href]="'mailto:' + person.email">
                    <mat-icon aria-hidden="true">mail</mat-icon>
                    <span>{{ person.email }}</span>
                  </a>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>

            <p class="empty-state" *ngIf="persons.length === 0">
              No people returned from the API yet.
            </p>
          </ng-container>
        </div>
      </mat-card-content>
    </mat-card>
  </main>
</div>
